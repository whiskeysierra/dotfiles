#!/bin/sh

format="%(refname:short) origin/master"
options="--no-merges"

for argument in $@; do
    case "$argument" in
        '-t'|'--tracking')
            format="%(refname:short) %(upstream:short)"
            ;;
        '-m'|'--merges')
            options=""
            ;;
        *)
            ;;
    esac
done
(
echo Branch#Behind#Ahead#Relative to
git for-each-ref --format="$format" refs/heads | \
while read local remote
do
    [ -z "$remote" ] && continue
    BEHIND=$(git rev-list $options ${local}..${remote} --count)
    AHEAD=$(git rev-list $options ${remote}..${local} --count)
    echo "$local#-$BEHIND#+$AHEAD#$remote"
done) | column -t -s '#'
