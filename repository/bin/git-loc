#!/bin/sh

if [ "$1" = "--help" ]; then
	echo "Usage:  $0 [--by-added|--by-removed|--by-sum]" >&2
	exit 1
fi

sorting=7  # --by-sum
[ "$1" = "--by-added" ] && sorting=3
[ "$1" = "--by-removed" ] && sorting=5

git log --numstat --no-merges --pretty=format:%ae | awk '
          author == "" { author = $0; next }
          /^$/ { author = ""; next }
          { added[author] += $1; removed[author] += $2 }
          END { for (author in added) {
            print author, "added", added[author], "removed", removed[author], "sum", added[author]-removed[author]
          } }' | sort -n -r -k $sorting
